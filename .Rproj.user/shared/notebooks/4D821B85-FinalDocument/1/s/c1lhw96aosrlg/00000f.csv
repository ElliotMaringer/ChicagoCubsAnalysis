"0",""
"0","# Compute derived metrics and format"
"0","pca_halves_plot <- pca_halves %>%"
"0","  mutate("
"0","    HR_per_game = HR / G,"
"0","    RBI_per_game = RBI / G,"
"0","    AVG = H / AB,"
"0","    OPS = OPS,  # Assuming already present"
"0","    Split = factor(Split, levels = c(""1st Half"", ""2nd Half""))"
"0","  ) %>%"
"0","  select(Split, AVG, OPS, HR_per_game, RBI_per_game) %>%"
"0","  pivot_longer(-Split, names_to = ""Metric"", values_to = ""Value"")"
"0",""
"0","# Calculate percent changes"
"0","pca_percent_changes <- pca_halves_plot %>%"
"0","  pivot_wider(names_from = Split, values_from = Value) %>%"
"0","  mutate("
"0","    pct_change = (`2nd Half` - `1st Half`) / `1st Half` * 100,"
"0","    max_value = pmax(`1st Half`, `2nd Half`)"
"0","  )"
"0",""
"0","# Plot"
"0","ggplot(pca_halves_plot, aes(x = Metric, y = Value, fill = Split)) +"
"0","  geom_bar(stat = ""identity"", position = position_dodge(width = 0.7), width = 0.6) +"
"0","  geom_text("
"0","    data = pca_percent_changes,"
"0","    aes("
"0","      x = Metric,"
"0","      y = max_value + 0.02,"
"0","      label = paste0(round(pct_change, 1), ""%"")"
"0","    ),"
"0","    inherit.aes = FALSE,"
"0","    vjust = 0,"
"0","    size = 4,"
"0","    color = ""red"""
"0","  ) +"
"0","  labs("
"0","    title = ""Pete Crow-Armstrong â€“ Pre vs Post All-Star Metrics"","
"0","    x = ""Metric"","
"0","    y = ""Value"","
"0","    fill = ""Season Half"""
"0","  ) +"
"0","  scale_fill_manual(values = c(""1st Half"" = ""#0072B2"", ""2nd Half"" = ""#D55E00"")) +"
"0","  theme_minimal()"
"0",""
